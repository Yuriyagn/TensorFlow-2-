## Recipe arch
1. `python agent_trainer_saver.py`
2. `agent_deployer_server.sh` or .py using POpen/Dockerpypkg for xplatform?
3. `python client_app.py`


## Dev Notes
1. Serving Deep RL Agent actions:
    1. Install the latest nvidia driver on host that supports your GPU
    2. Pull Nvidia Triton server container image:
        1. Check the Nvidia framework support matrix at: https://docs.nvidia.com/deeplearning/frameworks/support-matrix/index.html
        1. Pick the container image version `xx.yy` that supports your nvidia driver version
        For example, if you have installed nvidia driver version (find out by running `nvidia-smi`) 450.83, containers versions built with CUDA 11.0.3 or lower like cntainer version `20.09` or older will work.

        1. Once you have picked the container image version `xx.yy`, pull the image from NVCR: `docker pull nvcr.io/nvidia/tritonserver:xx.yy-py3`
    3.  Serve your RL Agent actions using Nvidia Triton: `$ docker run --gpus=1 --rm -p8000:8000 -p8001:8001 -p8002:8002 -v/full/path/to/docs/examples/model_repository:/models nvcr.io/nvidia/tritonserver:<xx.yy>-py3 tritonserver --model-repository=/models --strict-model-config=false --log-verbose=1`

`docker run --shm-size=1g --ulimit memlock=-1 --ulimit stack=67108864 --gpus=1 --rm -p8000:8000 -p8001:8001 -p8002:8002 -v$PWD:/models nvcr.io/nvidia/tritonserver:20.09-py3 tritonserver --model-repository=/models --strict-model-config=false --log-verbose=1`

2. Testing with a client/env
    1. [Install triton client libraries](https://github.com/triton-inference-server/server/blob/master/docs/client_libraries.md#getting-the-client-libraries). Using pip, the steps are:
        -`pip install nvidia-pyindex`
        - `pip install tritonclient[all]`
        (optional) `sudo apt update && apt install libb64-dev` for running `perf_analyzer` 

## Sample `config.pb` for TF2 model with Triton (autogenerated)
    **NOTES**: Modified config to add input-> format-> "FORMAT_NHWC" if not specified, "FORMAT_NONE" is inferred which can lead to issues on the client side
For PPO Agent (`7_social_media_mute_user_agent.py`)
```json


{                                                                                                                     
    "name": "actor",                                                                                                  
    "platform": "tensorflow_savedmodel",                                                                              
    "backend": "tensorflow",                                                                                          
    "version_policy": {                                                                                               
        "latest": {                                                                                                   
            "num_versions": 1                                                                                         
        }                                                                                                             
    },                                                                                                                
    "max_batch_size": 1,                                                                                              
    "input": [                                                                                                        
        {                                                                                                             
            "name": "input_1",                                                                                        
            "data_type": "TYPE_FP64",                                                                                 
            "dims": [                                                                                                 
                64,                                                                                                   
                64,                                                                                                   
                3                                                                                                     
            ],
            "format": "FORMAT_NHWC"                                                                                                         
        }                                                                                                             
    ],
    "output": [
        {
            "name": "lambda", 
            "data_type": "TYPE_FP64",
            "dims": [
                2
            ]
        },
        {
            "name": "lambda_1",
            "data_type": "TYPE_FP64",
            "dims": [
                2
            ]
        }
    ],
    "batch_input": [],
    "batch_output": [],
    "optimization": {
        "priority": "PRIORITY_DEFAULT",
        "input_pinned_memory": {
            "enable": true
        },
        "output_pinned_memory": {
            "enable": true
        }
    },
    "instance_group": [
        {
            "name": "actor",
            "kind": "KIND_CPU",
            "count": 1,
            "gpus": [],
            "profile": []
        }
    ],
    "default_model_filename": "model.savedmodel",
    "cc_model_filenames": {}, 
    "metric_tags": {},
    "parameters": {},
    "model_warmup": []
}
```